define((function(){"use strict";class t{constructor(t,e){this.x=t,this.y=e}getDistance(t,e){const i=t-this.x,s=e-this.y;return Math.sqrt(i*i+s*s)}isOnLine(t,e,i,s){if(this.y>=Math.min(e,s)&&this.y<=Math.max(e,s)&&this.x>=Math.min(t,i)&&this.x<=Math.max(t,i)){const n=(this.x-t)*(e-s)-(t-i)*(this.y-e);if(n<2e-10&&n>-2e-10)return!0}return!1}}class e extends t{constructor(t,e,i,s=!1){super(t,e),this.value=i,this.isActive=s}}class i{static createElement(t,e){const s=document.createElementNS(i.namespace,t);for(const t in e)s.setAttribute(t,e[t]+"");return s}static createSvgElement(){return i.createElement("svg",{xmlns:i.namespace,version:i.version})}}i.namespace="http://www.w3.org/2000/svg",i.version="1.1";return class{constructor(t,e){this.dotsPos=[],this.container=document.querySelector(t),this.callback=e,this.svg=i.createSvgElement(),this.svg.style.width=this.svg.style.height="100%",this.container.appendChild(this.svg),this.init();for(const t of this.dotsPos)t.element=this.drawDot(t.x,t.y,this.radius,"#eee","dot"),this.addClickEventListener(t);this.addTouchMoveEventListener(),this.addTouchCompleteEventListener()}init(){this.width=this.container.clientWidth,this.radius=this.width/6*.7,this.margin=(this.width-6*this.radius)/4,this.style&&document.head.removeChild(this.style),this.style=class{static addStyle(t){const e=document.createElement("style");return e.innerHTML=t,document.head.appendChild(e),e}}.addStyle(`\n            .inner-dot {\n                animation: gl-inner-dot-scale .25s ease-in;\n            }\n            @keyframes gl-inner-dot-scale {\n                0% {\n                    r: ${this.radius/2.5};\n                } 50% {\n                    r: ${this.radius/2};\n                } 100% {\n                    r: ${this.radius/2.5};\n                }\n            }\n        `);const t=[this.radius+this.margin,3*this.radius+2*this.margin,5*this.radius+3*this.margin];this.dotsPos=[new e(t[0],t[0],"1"),new e(t[1],t[0],"2"),new e(t[2],t[0],"3"),new e(t[0],t[1],"4"),new e(t[1],t[1],"5"),new e(t[2],t[1],"6"),new e(t[0],t[2],"7"),new e(t[1],t[2],"8"),new e(t[2],t[2],"9")]}addClickEventListener(e){const s=()=>{this.isDirty||e.isActive||(this.isDirty=!0,e.isActive=!0,e.element.setAttribute("fill","#a7ffeb"),this.drawDot(e.x,e.y,this.radius/2.5,"#1de9b6","inner-dot"),this.lastPos=new t(e.x,e.y),this.currentPos=new t(e.x,e.y),this.points=`${e.x} ${e.y} `,this.polyline=i.createElement("polyline",{points:this.points,"stroke-linejoin":"round","stroke-linecap":"round",stroke:"#1de9b6",style:"fill:none;stroke-width:"+this.radius/4}),this.svg.appendChild(this.polyline),this.value=`${e.value}`)};"ontouchstart"in document.documentElement?e.element.addEventListener("touchstart",(t=>{t.stopPropagation(),1===t.touches.length&&s()})):e.element.addEventListener("mousemove",(t=>{1===t.buttons&&s()}))}addTouchMoveEventListener(){const e=(e,i,s)=>{if(s.preventDefault(),this.polyline){e-=this.container.offsetLeft,i-=this.container.offsetTop;for(const s of this.dotsPos){if(!s.isActive&&s.getDistance(e,i)<=.85*this.radius){this.lastPos.x=this.currentPos.x,this.lastPos.y=this.currentPos.y,this.currentPos=new t(s.x,s.y),this.points=this.points+`${s.x} ${s.y} `,s.element.setAttribute("fill","#a7ffeb"),s.isActive=!0,this.drawDot(s.x,s.y,this.radius/2.5,"#1de9b6","inner-dot");for(const t of this.dotsPos)!t.isActive&&t.isOnLine(this.lastPos.x,this.lastPos.y,this.currentPos.x,this.currentPos.y)&&(t.element.setAttribute("fill","#a7ffeb"),t.isActive=!0,this.drawDot(t.x,t.y,this.radius/2.5,"#1de9b6","inner-dot"),this.value+=t.value);this.value+=s.value}this.polyline.setAttribute("points",this.points+`${e} ${i} `)}}};"ontouchmove"in document.documentElement?this.svg.addEventListener("touchmove",(t=>{e(t.changedTouches[0].clientX,t.changedTouches[0].clientY,t)})):document.addEventListener("mousemove",(t=>{1===t.buttons&&"none"!==this.container.style.pointerEvents&&e(t.clientX,t.clientY,t)}))}addTouchCompleteEventListener(){const t=()=>{this.isDirty&&(this.container.style.pointerEvents="none",this.polyline&&this.polyline.setAttribute("points",this.points),this.verify(),this.callback.complete&&this.callback.complete(this.value),setTimeout((()=>{this.reset(),this.container.style.pointerEvents="auto"}),1e3))};"ontouchend"in document.documentElement?(this.svg.addEventListener("touchend",(()=>t())),this.svg.addEventListener("touchcancel",(()=>t()))):document.addEventListener("mouseup",(()=>t()))}resize(){window.addEventListener("resize",function(t,e){let i=null;return function(){i&&clearTimeout(i),i=window.setTimeout(t,e)}}((()=>this.init()),250))}verify(){if(!this.callback.verify(this.value)){this.polyline&&this.polyline.setAttribute("stroke","#ff5252");for(const t of this.dotsPos)t.isActive&&t.element.setAttribute("fill","#ffcdd2");const t=document.querySelectorAll(".inner-dot");for(let e=0;e<t.length;e++)t[e].setAttribute("fill","#ff5252");"vibrate"in window.navigator&&window.navigator.vibrate(150)}}reset(){this.points="",this.value="",this.isDirty=!1,this.polyline&&(this.svg.removeChild(this.polyline),this.polyline=null);const t=this.svg.querySelectorAll(".inner-dot");for(const e of t)this.svg.removeChild(e);for(const t of this.dotsPos)t.isActive&&(t.isActive=!1),"#eee"!==t.element.getAttribute("fill")&&t.element.setAttribute("fill","#eee");this.callback.reset&&this.callback.reset()}drawDot(t,e,s,n,o){const r=i.createElement("circle",{cx:t,cy:e,r:s,fill:n,class:o});return this.svg.appendChild(r),r}}}));
//# sourceMappingURL=patternlock.amd.min.js.map
